<div class="welcome-side-bar">
	<div class="filler-medium"></div>
	<center>
		<img class="welcome-logo" src="<%= asset_path('logo.png') %>">
	</center>
	<h3>Hi <%= User.name %>!</h3>
	<ul class="welcome-nav-links">
		<li><%= link_to 'All Boards', welcome_path, :method=>'get', class: 'welcome-sidebar-link' %></li>
		<li><%= link_to 'New Board', new_board_path, :method=>'get', class: 'welcome-sidebar-link' %></li>
		<li><a class="welcome-sidebar-link" href="#">Settings</a></li>
		<li><%= link_to 'Sign Out', destroy_user_session_path, :method=>'delete', class: 'welcome-sidebar-link' %></li>
	</ul>
</div>

<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=places"></script>

<script type="text/javascript"> 

// MAGIC
$(document).ready(function(){    
	if(document.URL.indexOf("#")==-1){
		url = document.URL+"#";
		location = "#";
		location.reload(true);
	}
});

// Toggle Map Details
function openBoardDetails(board) {
	e = document.getElementById(board);
	e.classList.toggle('board-title-open');
};

// Initialize the map
var map = null;
var marker = null;

var infowindow = new google.maps.InfoWindow({ 
	size: new google.maps.Size(200, 300)
});

// A function to create the marker and set up the event window function 
function createMarker(latlng, name, coordinates, html) {
	var coords = coordinates; // LatLng Object
	var contentString = html;
	var marker = new google.maps.Marker({
		position: latlng,
		map: map,
		zIndex: Math.round(latlng.lat()*-100000)<<5
	});

	google.maps.event.addListener(marker, 'click', function() {
		infowindow.setContent(contentString); 
		infowindow.open(map,marker);
	});
	google.maps.event.trigger(marker, 'click');    
	return marker;
}

function initialize() {
	var myOptions = {
		zoom: 4,
		center: new google.maps.LatLng(42.5, -80.35),
		mapTypeControl: true,
		navigationControl: true,
		mapTypeId: google.maps.MapTypeId.ROADMAP
	}
	map = new google.maps.Map(document.getElementById("full-view-map"), myOptions);

	google.maps.event.addListener(map, 'click', function() { infowindow.close(); });

	google.maps.event.addListener(map, 'click', function(event) {

		if (marker) {
			marker.setMap(null);
			marker = null;
		}
		marker = createMarker(event.latLng, "name", event.latLng, '' +
			'<input class="new-board-input" placeholder="Title"> <button class="new-pin-submit">Add Pin</button>' + 
			'<br>'); 
	});

	var markers = [];
	// Create the search box and link it to the UI element.
	var input = /** @type {HTMLInputElement} */(
		document.getElementById('pac-input'));
	map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);

	var searchBox = new google.maps.places.SearchBox(
		/** @type {HTMLInputElement} */(input));

  google.maps.event.addListener(searchBox, 'places_changed', function() {
  	var places = searchBox.getPlaces();

  	if (places.length == 0) {
  		return;
  	}
  	for (var i = 0, marker; marker = markers[i]; i++) {
  		marker.setMap(null);
  	}

    // For each place, get the icon, place name, and location.
    markers = [];
    var bounds = new google.maps.LatLngBounds();
    for (var i = 0, place; place = places[i]; i++) {
    	var image = {
    		url: place.icon,
    		size: new google.maps.Size(71, 71),
    		origin: new google.maps.Point(0, 0),
    		anchor: new google.maps.Point(17, 34),
    		scaledSize: new google.maps.Size(0, 0)
    	};

      // Create a marker for each place.
      var marker = new google.maps.Marker({
      	map: map,
      	icon: image,
      	title: place.name,
      	position: place.geometry.location
      });

      markers.push(marker);

      bounds.extend(place.geometry.location);
  }

  	var northeast = bounds.getNorthEast();
  	var southwest = bounds.getSouthWest(); 

  	var northeast_lat = northeast.lat();
  	var northeast_long = northeast.lng();
  	var southwest_lat = southwest.lat();
  	var southwest_long = southwest.lng();

  	var new_northeast = new google.maps.LatLng(northeast_lat + 0.5, northeast_long + 0.5);
  	var new_southwest = new google.maps.LatLng(southwest_lat - 0.5, southwest_long - 0.5);

  	bounds = new google.maps.LatLngBounds(new_southwest, new_northeast);
    map.fitBounds(bounds);

});

  google.maps.event.addListener(map, 'bounds_changed', function() {
  	var bounds = new google.maps.LatLngBounds(
    	new google.maps.LatLng(-133.8902, 151.1759),
    	new google.maps.LatLng(133.8474, 151.2631));
  	searchBox.setBounds(bounds);
  });
}

google.maps.event.addDomListener(window, 'load', initialize);

</script> 

<div class="board-content-container">
	<div class="board-content">

		<input id="pac-input" style="width: 300px" class="controls" type="text" placeholder="Search Box">
		<div class="board-title board-title-open" id="board-title">
			<div class="board-title-preview" onclick="openBoardDetails('board-title')">
				<span class="board-name"><%= @board.title %></span>
				<span class="board-options"><i class="fa fa-chevron-up"></i></span>
			</div>
			<div class="edit-board">
				Contributor: User <br>
				Last Updated: Today <br>
				Something: Hello <br> <br>
				<button class="board-add-pin">Add Pin</button>
			</div>
		</div>
	</div>

	<div id="full-view-map" class="full-view-map">
	</div>
</div>


